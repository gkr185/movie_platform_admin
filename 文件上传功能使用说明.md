# 电影平台文件上传功能使用说明

## 功能概述

电影平台管理后台已集成文件上传服务，支持电影海报、预告片、电影视频等文件的上传和管理。

## 主要特性

### 1. 支持的文件类型
- **图片文件**: JPG, JPEG, PNG, GIF, BMP, WEBP
- **视频文件**: MP4, AVI, MOV, WMV, FLV, MKV, WEBM

### 2. 文件大小限制
- **海报图片**: 最大 10MB
- **预告片视频**: 最大 500MB  
- **电影视频**: 最大 1000MB

### 3. 存储策略
- 文件按分类和日期自动分目录存储
- 自动生成唯一文件名避免冲突
- 支持文件预览和管理

## 使用方法

### 1. 电影上传页面 (`/movie/upload`)

这是专门的电影上传页面，提供完整的电影信息录入和文件上传功能：

#### 基本信息
- 电影标题、原始标题
- 导演、编剧、主演
- 类型、制片国家、语言
- 上映日期、时长、IMDb ID
- 剧情简介

#### 文件上传
- **电影海报**: 点击"上传海报"按钮选择图片文件
- **预告片**: 点击"上传预告片"按钮选择视频文件
- **电影视频**: 点击"上传电影视频"按钮选择视频文件

#### 属性设置
- 推荐/热门/VIP专享标记
- 上线/下线状态

#### 分类标签
- 支持多分类标签管理
- 可添加和移除分类标签

### 2. 电影列表页面 (`/movie/list`)

在电影列表的编辑功能中也集成了文件上传：

#### 编辑电影
1. 点击电影列表中的"编辑"按钮
2. 在弹出的对话框中找到"文件上传"区域
3. 可以上传或更新电影的海报、预告片、视频文件
4. 也可以直接输入文件链接

## 上传流程

### 新建电影时的上传流程
1. **先创建电影记录**: 填写基本信息后点击"创建电影"
2. **获取电影ID**: 系统自动分配电影ID
3. **上传文件**: 使用获得的电影ID上传相关文件
4. **自动更新数据库**: 文件上传成功后自动更新电影表的URL字段

### 编辑现有电影时的上传流程
1. **直接上传**: 由于已有电影ID，可以直接上传文件
2. **自动关联**: 文件自动关联到对应的电影记录
3. **实时更新**: 上传成功后立即更新数据库中的URL字段

## 文件管理

### 文件存储结构
```
public/uploads/
├── posters/           # 电影海报
│   └── 2024/01/15/   # 按日期分目录
├── videos/            # 视频文件
│   └── 2024/01/15/   # 按日期分目录
└── ...
```

### 文件命名规则
- 格式: `UUID_时间戳.扩展名`
- 示例: `a1b2c3d4-e5f6-7890-abcd-ef1234567890_1703123456789.jpg`

### 文件访问URL
- 格式: `http://localhost:8068/uploads/分类/年/月/日/文件名`
- 示例: `http://localhost:8068/uploads/posters/2024/01/15/a1b2c3d4_1703123456789.jpg`

## 技术实现

### 前端组件
- **FileUpload.vue**: 通用文件上传组件
- **MovieUpload.vue**: 电影上传页面
- **MovieList.vue**: 电影列表管理页面

### API接口
- **上传文件**: `POST /api/files/upload`
- **上传并更新数据库**: `POST /api/files/upload-and-update`
- **批量上传**: `POST /api/files/upload/batch`
- **文件管理**: 查询、删除等操作

### 后端服务
- **FileUploadService**: 文件上传微服务 (端口: 8068)
- **自动URL更新**: 上传成功后自动更新相关数据库表

## 注意事项

### 1. 服务依赖
- 确保FileUploadService服务正常运行 (localhost:8068)
- 确保数据库连接正常
- 确保文件存储目录有写权限

### 2. 文件大小
- 根据网络环境调整上传超时时间
- 大文件上传建议在网络稳定环境下进行
- 注意服务器磁盘空间

### 3. 文件格式
- 严格按照支持的文件格式上传
- 系统会自动验证文件类型和大小
- 不支持的格式会被拒绝

### 4. 数据一致性
- 文件上传和数据库更新在同一事务中
- 上传失败时不会更新数据库记录
- 建议定期检查文件和数据库的一致性

## 故障排除

### 常见问题

1. **上传失败**
   - 检查文件大小是否超限
   - 检查文件格式是否支持
   - 检查网络连接是否稳定
   - 检查FileUploadService服务状态

2. **文件无法访问**
   - 检查文件路径是否正确
   - 检查静态资源配置
   - 检查文件是否真实存在

3. **数据库未更新**
   - 检查电影ID是否正确
   - 检查数据库连接
   - 查看服务日志

### 日志查看
- 前端: 浏览器开发者工具 Console
- 后端: FileUploadService 服务日志

## 扩展功能

### 未来可能的增强
1. **分片上传**: 支持大文件分片上传
2. **断点续传**: 网络中断后可继续上传
3. **图片压缩**: 自动压缩大尺寸图片
4. **视频转码**: 自动转换视频格式
5. **CDN集成**: 集成CDN加速文件访问

## 联系支持

如遇到问题或需要技术支持，请联系开发团队。 