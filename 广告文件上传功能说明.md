# 广告文件上传功能使用说明

## 功能概述

广告管理模块已集成文件上传服务，支持广告图片和视频的上传和管理，提供更便捷的广告素材管理功能。

## 主要特性

### 1. 支持的文件类型
- **图片文件**: JPG, JPEG, PNG, GIF, BMP, WEBP
- **视频文件**: MP4, AVI, MOV, WMV, FLV, MKV, WEBM

### 2. 文件大小限制
- **广告图片**: 最大 10MB
- **广告视频**: 最大 500MB

### 3. 存储策略
- 文件按分类存储在 `uploads/ads/` 目录下
- 按日期自动分目录存储
- 自动生成唯一文件名避免冲突
- 支持文件预览和管理

## 使用方法

### 1. 广告创建页面 (`/ad/create`)

#### 基本信息
- 广告标题
- 广告位置（首页轮播、侧边栏、顶部横幅、播放前广告、播放暂停广告）
- 排序权重
- 状态（启用/禁用）

#### 文件上传
- **广告图片**: 
  - 点击"上传广告图片"按钮选择图片文件
  - 支持拖拽上传
  - 实时预览上传的图片
  - 也可以直接输入图片URL

- **广告视频**: 
  - 点击"上传广告视频"按钮选择视频文件
  - 支持格式：MP4, AVI, MOV, WMV, FLV, MKV, WEBM
  - 支持大文件上传（最大500MB）
  - 也可以直接输入视频链接

#### 其他设置
- 跳转链接：用户点击广告时的目标链接
- 投放时间：可设置广告的开始和结束时间
- 广告预览：实时预览广告效果

### 2. 广告编辑页面 (`/ad/edit/:id`)

编辑页面复用创建页面的所有功能，包括：
- 修改广告基本信息
- 重新上传广告图片或视频
- 更新跳转链接和投放时间
- 实时预览修改效果

### 3. 广告列表页面 (`/ad/list`)

在列表页面可以：
- 查看广告缩略图预览
- 识别广告类型（图片/视频/链接）
- 快速编辑广告（跳转到编辑页面）
- 批量管理广告状态

## 上传流程

### 新建广告时的上传流程
1. **填写基本信息**: 输入广告标题、选择位置等
2. **上传广告素材**: 
   - 上传广告图片（必需）
   - 上传广告视频（可选）
3. **设置其他参数**: 跳转链接、投放时间等
4. **预览确认**: 查看广告预览效果
5. **保存广告**: 点击"创建广告"按钮
6. **自动关联**: 文件自动关联到新创建的广告记录

### 编辑现有广告时的上传流程
1. **进入编辑页面**: 从广告列表点击"编辑"
2. **查看现有素材**: 系统显示当前的图片和视频
3. **更新文件**: 
   - 重新上传新的图片或视频
   - 或修改文件URL链接
4. **实时更新**: 上传成功后自动更新数据库记录
5. **保存修改**: 点击"更新广告"完成修改

## 文件管理

### 文件存储结构
```
public/uploads/
└── ads/                    # 广告素材目录
    └── 2024/01/15/        # 按日期分目录
        ├── image_uuid_timestamp.jpg
        └── video_uuid_timestamp.mp4
```

### 文件命名规则
- 格式: `UUID_时间戳.扩展名`
- 示例: `a1b2c3d4_1703123456789.jpg`

### 文件访问URL
- 格式: `http://localhost:8068/uploads/ads/年/月/日/文件名`
- 示例: `http://localhost:8068/uploads/ads/2024/01/15/a1b2c3d4_1703123456789.jpg`

## 广告类型识别

系统会根据上传的文件自动识别广告类型：

1. **图片广告**: 只有图片文件
2. **视频广告**: 包含视频文件
3. **链接广告**: 包含跳转链接

在广告列表中会显示相应的标签标识。

## 技术实现

### 前端组件
- **AdCreate.vue**: 广告创建/编辑页面，集成FileUpload组件
- **AdList.vue**: 广告列表管理页面
- **FileUpload.vue**: 通用文件上传组件

### API接口
- **上传文件**: `POST /api/files/upload`
- **上传并更新数据库**: `POST /api/files/upload-and-update`
- **文件管理**: 查询、删除等操作

### 数据库字段
- `image_url`: 广告图片URL
- `video_url`: 广告视频URL
- `link_url`: 跳转链接URL

## 注意事项

### 1. 文件要求
- **图片要求**: 建议使用高质量图片，分辨率适合广告位置
- **视频要求**: 建议使用MP4格式，确保兼容性
- **文件大小**: 注意文件大小限制，避免影响加载速度

### 2. 广告位置适配
- **首页轮播**: 建议使用16:9比例的横向图片
- **侧边栏**: 建议使用竖向或正方形图片
- **顶部横幅**: 建议使用宽屏比例图片
- **视频广告**: 确保视频格式兼容主流浏览器

### 3. 性能优化
- 大文件上传建议在网络稳定环境下进行
- 视频文件建议进行适当压缩
- 定期清理无用的广告素材文件

### 4. 安全性
- 系统会自动验证文件类型和大小
- 不支持的文件格式会被拒绝
- 文件存储使用唯一文件名，防止冲突

## 故障排除

### 常见问题

1. **上传失败**
   - 检查文件大小是否超限
   - 检查文件格式是否支持
   - 检查网络连接是否稳定
   - 检查FileUploadService服务状态

2. **图片无法显示**
   - 检查图片URL是否正确
   - 检查图片文件是否存在
   - 检查静态资源配置

3. **视频无法播放**
   - 检查视频格式是否兼容
   - 检查视频文件大小
   - 检查浏览器支持情况

### 日志查看
- 前端: 浏览器开发者工具 Console
- 后端: FileUploadService 服务日志

## 最佳实践

### 1. 图片优化
- 使用适当的图片分辨率
- 选择合适的图片格式（JPG适合照片，PNG适合图标）
- 适当压缩图片以提高加载速度

### 2. 视频优化
- 使用H.264编码的MP4格式
- 控制视频时长和文件大小
- 提供视频封面图片

### 3. 用户体验
- 提供清晰的上传进度提示
- 支持文件预览功能
- 提供详细的错误提示信息

## 扩展功能

### 未来可能的增强
1. **图片编辑**: 在线裁剪、调整图片
2. **视频处理**: 自动生成视频缩略图
3. **批量上传**: 支持多文件同时上传
4. **模板管理**: 预设广告模板
5. **效果统计**: 广告点击率统计

## 联系支持

如遇到问题或需要技术支持，请联系开发团队。 